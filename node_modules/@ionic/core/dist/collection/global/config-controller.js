import { readQueryParam } from './platform-configs';
import { isDef } from '../utils/helpers';
export function createConfigController(configObj, platforms) {
    configObj = configObj || {};
    function get(key, fallback) {
        const queryValue = readQueryParam(window.location.href, `ionic${key}`);
        if (isDef(queryValue)) {
            return configObj[key] = (queryValue === 'true' ? true : queryValue === 'false' ? false : queryValue);
        }
        if (isDef(configObj[key])) {
            return configObj[key];
        }
        let settings = null;
        for (let i = 0; i < platforms.length; i++) {
            settings = platforms[i]['settings'];
            if (settings && isDef(settings[key])) {
                return settings[key];
            }
        }
        return fallback !== undefined ? fallback : null;
    }
    function getBoolean(key, fallback) {
        const val = get(key);
        if (val === null) {
            return fallback !== undefined ? fallback : false;
        }
        if (typeof val === 'string') {
            return val === 'true';
        }
        return !!val;
    }
    function getNumber(key, fallback) {
        const val = parseFloat(get(key));
        return isNaN(val) ? (fallback !== undefined ? fallback : NaN) : val;
    }
    function set(key, value) {
        configObj[key] = value;
    }
    return {
        get,
        getBoolean,
        getNumber,
        set
    };
}
